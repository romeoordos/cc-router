# CC Router

A smart API router for Claude Code that intelligently routes requests to different AI models based on agent detection, orchestrator tiers, and model capabilities.

## Important Notes

> **Anthropic API Only**: this router is designed for Claude Code and works exclusively with the [Anthropic Messages API](https://docs.anthropic.com/en/api/messages). It expects requests in Anthropic's format and proxies them to configured backend endpoints. Many popular LLM providers already have Anthropic-compatible APIs: Anthropic, OpenRouter, Z.AI, KIMI, Deepseek, MiniMax, Alibaba (Qwen), llama.cpp, etc. OpenAI GPT and Google Gemini models can be used via OpenRouter.

> **oh-my-claudecode Integration**: This router is designed to work with [oh-my-claudecode](https://github.com/Yeachan-Heo/oh-my-claudecode), a multi-agent orchestration layer for Claude Code. Agent detection relies on `SubagentStart` hook messages generated by oh-my-claudecode. Claude Code Teams are not supported.

## Features

- **Model Routing** - Routes requests to the optimal model based on:
  - Agent type detection (using OMC hooks and naming)
  - Orchestrator tier fallback (haiku/sonnet/opus)
  - Topic summarizer special handling (uses haiku tier for efficiency)
- **Hot Reload Configuration** - Configuration changes take effect immediately without restart
- **TUI Dashboard** - Interactive terminal UI showing real-time metrics
- **Token Counting** - Built-in endpoint for token estimation
- **Metrics Collection** - Tracks request latency, tokens/second, and routing decisions

## Supported Agents

The router detects and routes the following oh-my-claudecode agents:

| Agent | Description |
|-------|-------------|
| `analyst` | Requirements analysis, acceptance criteria, hidden constraints |
| `api-reviewer` | API contracts, versioning, backward compatibility |
| `architect` | System design, boundaries, interfaces, long-horizon tradeoffs |
| `build-fixer` | Build and compilation error resolution |
| `code-reviewer` | Comprehensive code review across concerns |
| `critic` | Plan/design critical challenge |
| `debugger` | Root-cause analysis, regression isolation, failure diagnosis |
| `deep-executor` | Complex autonomous goal-oriented tasks |
| `dependency-expert` | External SDK/API/package evaluation |
| `designer` | UX/UI architecture, interaction design |
| `document-specialist` | External documentation & reference lookup |
| `executor` | Code implementation, refactoring, feature work |
| `explore` | Internal codebase discovery, symbol/file mapping |
| `git-master` | Commit strategy, history hygiene |
| `information-architect` | Taxonomy, navigation, findability |
| `performance-reviewer` | Hotspots, complexity, memory/latency optimization |
| `planner` | Task sequencing, execution plans, risk flags |
| `product-analyst` | Product metrics, funnel analysis, experiments |
| `product-manager` | Problem framing, personas/JTBD, PRDs |
| `qa-tester` | Interactive CLI/service runtime validation |
| `quality-reviewer` | Logic defects, maintainability, anti-patterns |
| `quality-strategist` | Quality strategy, release readiness, risk assessment |
| `scientist` | Data/statistical analysis |
| `security-reviewer` | Vulnerabilities, trust boundaries, authn/authz |
| `style-reviewer` | Formatting, naming, idioms, lint conventions |
| `test-engineer` | Test strategy, coverage, flaky-test hardening |
| `ux-researcher` | Heuristic audits, usability, accessibility |
| `verifier` | Completion evidence, claim validation, test adequacy |
| `vision` | Image/screenshot/diagram analysis |
| `writer` | Docs, migration notes, user guidance |

## Installation

### Bun (recommended)

```bash
git clone https://github.com/romeoordos/cc-router.git
cd cc-router
bun install
bun run build
bun link
```

### NPM

```bash
git clone https://github.com/romeoordos/cc-router.git
cd cc-router
npm install
npm run build
npm link
```

### Docker

```bash
git clone https://github.com/romeoordos/cc-router.git
cd cc-router
# Build the image
docker build -t cc-router .

# Run with config mounted
docker run -d \
  --name claude-router \
  -p 3010:3010 \
  -e PORT=3010 \
  -v ~/.claude:/root/.claude \
  cc-router
```

## Quick Start

```bash
# Set environment variable for Claude Code
export ANTHROPIC_BASE_URL=http://localhost:3010

# Start the router
cc-router

# Edit with your configuration if needed
$EDITOR ~/.claude/router_config.jsonc

# Start Claude Code
claude

```

## Configuration

The router uses `router_config.jsonc` for configuration. This file supports:

- Model definitions with URL, API key, and context window
- Agent-to-model mappings
- Orchestrator tier defaults

## Claude subscription

Anthropic models configuration "apiKey" should remain empty if Claude Code is used with Claude subscription. Authorization will be passed through without modification. This is default when app is started first time.

### Config File Locations

The router searches for `router_config.jsonc` in the following locations (in order):

1. `./router_config.jsonc` - Current working directory (development only)
3. `~/.claude/router_config.jsonc` - User home config

### Example Configuration

```jsonc
{
  // ============================================================================
  // MODEL CONFIGURATION
  // ============================================================================
  // Define available models with their API endpoints and credentials.
  // Each model must have: url, apiKey, and contextWindow (in tokens).
  // ============================================================================
  "models": {
    "claude-opus-4-6": {
      "url": "https://api.anthropic.com",
      "apiKey": "",
      "contextWindow": 200000
    },
    "claude-sonnet-4-6": {
      "url": "https://api.anthropic.com",
      "apiKey": "",
      "contextWindow": 200000
    },
    "claude-haiku-4-5": {
      "url": "https://api.anthropic.com",
      "apiKey": "",
      "contextWindow": 200000
    }
  },

  // ============================================================================
  // AGENT MODEL MAPPING
  // ============================================================================
  // Maps each agent type to a specific model.
  // The router detects which agent is being invoked (from system prompt or explicit)
  // and uses the corresponding model from this mapping.
  // ============================================================================
  "agentModelMap": {
    "analyst": "claude-opus-4-6",
    "api-reviewer": "claude-sonnet-4-6",
    "architect": "claude-opus-4-6",
    "build-fixer": "claude-sonnet-4-6",
    "code-reviewer": "claude-opus-4-6",
    "critic": "claude-opus-4-6",
    "debugger": "claude-sonnet-4-6",
    "deep-executor": "claude-opus-4-6",
    "dependency-expert": "claude-sonnet-4-6",
    "designer": "claude-sonnet-4-6",
    "document-specialist": "claude-sonnet-4-6",
    "executor": "claude-sonnet-4-6",
    "explore": "claude-haiku-4-5",
    "git-master": "claude-sonnet-4-6",
    "information-architect": "claude-sonnet-4-6",
    "performance-reviewer": "claude-sonnet-4-6",
    "planner": "claude-opus-4-6",
    "product-analyst": "claude-sonnet-4-6",
    "product-manager": "claude-sonnet-4-6",
    "qa-tester": "claude-sonnet-4-6",
    "quality-reviewer": "claude-opus-4-6",
    "quality-strategist": "claude-sonnet-4-6",
    "scientist": "claude-sonnet-4-6",
    "security-reviewer": "claude-opus-4-6",
    "style-reviewer": "claude-haiku-4-5",
    "test-engineer": "claude-sonnet-4-6",
    "ux-researcher": "claude-sonnet-4-6",
    "verifier": "claude-sonnet-4-6",
    "vision": "claude-sonnet-4-6",
    "writer": "claude-haiku-4-5"
  },

  // ============================================================================
  // ORCHESTRATOR MODEL MAPPING (FALLBACK)
  // ============================================================================
  // Default model selection when no specific agent type is detected.
  // Used when the router operates in "orchestrator mode" and needs a model
  // based on the requested tier: haiku (fast/cheap), sonnet (balanced), opus (powerful).
  // ============================================================================
  "orchestratorModelMap": {
    "haiku": "claude-haiku-4-5",
    "sonnet": "claude-sonnet-4-6",
    "opus": "claude-opus-4-6"
  }
}
```

### Tested LLM Providers:
- Anthropic: https://api.anthropic.com (claude-haiku-4-5, claude-sonnet-4-6, claude-opus-4-6)
- OpenRouter: https://openrouter.ai/api (openrouter/aurora-alpha, x-ai/grok-code-fast-1, etc.)
- Z.AI: https://api.z.ai/api/anthropic (glm-4.7, glm-4.7-flash, glm-5, etc.)
- Kimi Code: https://api.kimi.com/coding/ (kimi-k2.5, etc.)
- Deepseek: https://api.deepseek.com/anthropic (deepseek-reasoner, deepseek-chat)
- MiniMax: https://api.minimax.io/anthropic (MiniMax-M2.5, etc.)
- Alibaba: https://coding-intl.dashscope.aliyuncs.com/apps/anthropic (qwen3.5-plus, qwen3-coder-next, etc.)
- llama.cpp: http://localhost:8080 (Huggging Face models, etc.)


### Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `PORT` | Server port | `3010` |

## Usage

### CLI Options

```bash
cc-router [options]

Options:
  -p, --port <port>    Server port (default: 3010, or PORT env var)
  --no-tui             Disable TUI dashboard
  -v, --version        Show version
  -h, --help           Show help
```

### Examples

```bash
# Start with TUI on default port
cc-router

# Start on custom port
cc-router --port 3010

# Start without TUI (for systemd/docker)
cc-router --no-tui

# Use PORT environment variable
PORT=3010 cc-router
```

### From Source (Development)

```bash
# Development mode with hot reload
bun run dev

# Build for production
bun run build

# Run built version
bun run start
```

### TUI Mode

The TUI activates automatically when running in an interactive terminal. It shows real-time metrics including:
- Request latency
- Tokens per second
- Model routing decisions
- Agent detection

Press `Ctrl+C` to exit.


## Routing Logic

The router uses the following priority order:

1. **Topic Summarizer** - If system prompt contains "Analyze if this message indicates a new conversation topic", routes to `orchestratorModelMap.haiku`

2. **Agent-Specific** - If an agent type is detected from the request, uses the corresponding model from `agentModelMap`

3. **Orchestrator Tier** - If no agent detected, uses tier-based routing:
   - Requested model contains "haiku" → `orchestratorModelMap.haiku`
   - Requested model contains "sonnet" → `orchestratorModelMap.sonnet`
   - Requested model contains "opus" → `orchestratorModelMap.opus`

## Adding New Models

1. Add the model configuration to `router_config.jsonc`:

```jsonc
"models": {
  "my-model": {
    "url": "https://api.example.com/anthropic",
    "apiKey": "your-key",
    "contextWindow": 100000
  }
}
```

2. Map agents to the new model:

```jsonc
"agentModelMap": {
  "my-agent": "my-model"
}
```

## License

MIT
